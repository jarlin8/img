!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=52)}({16:function(e,t){var n;n=jQuery,e.exports=Backbone.View.extend({template:TVE_Dash.tpl("views/functionality"),events:{"select2:select .tvd-am-functionality-select":function(e){this.changeFunctionality(e.params.data.id)}},render:function(){var e=this.model.getValue();return e?"login_redirect"!==this.model.getTag()||this.model.getOptions().map((function(e){return e.tag})).includes(e)||(e="custom"):e="inherit",this.$el.html(this.template({model:this.model,optionsTags:this.model.getOptions().map((function(e){return e.tag})),optionsNames:this.model.getOptions().map((function(e){return e.name})),selectedValue:e})),this.afterRender(),this.$el},afterRender:function(){},changeFunctionality:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.model.getActiveRole(),a=this.model.getTag();return i&&TVE_Dash.showLoader(),n.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.update_user_functionality,role:o,functionality:a,value:e},type:"post",dataType:"json"}).done((function(n){n.success?(t.model.set({value:e}),t.model.collection.trigger("change-functionality",[t.model.getTag(),e]),i&&TVE_Dash.success(n.message,4e3,null,"top")):i&&TVE_Dash.err(n.message,4e3,null,"top")})).always((function(){i&&TVE_Dash.hideLoader()}))}})},52:function(e,t,n){e.exports=n(53)},53:function(e,t,n){jQuery(document).ready((function(){var e=n(54),t=n(55),i=n(59),o=n(61),a=n(63);(new(Backbone.View.extend({template:TVE_Dash.tpl("views/content-wrapper"),el:".tvd-access-manager-setting",render:function(){this.$el.html(this.template());var n=new i,r=new o,l=new a,c=new e({productCollection:n,functionalitiesCollection:r,rolesCollection:l}),s=new t({productCollection:n,functionalitiesCollection:r,rolesCollection:l});return c.render(),s.render(),c.updateRoleInfo(),this.$el}}))).render()}))},54:function(e,t){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,a=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var o,a;o=jQuery,a=Backbone.View.extend({template:TVE_Dash.tpl("views/sidebar-item"),events:{"click .tvd-am-role":function(){this.model.activateRole()}},initialize:function(){var e=this;this.model.on("change:isActive",(function(){e.render()}))},render:function(){return this.$el.html(this.template({model:this.model})),this.$el}}),e.exports=Backbone.View.extend({el:".tvd-am-sidebar",initialize:function(e){this.rolesCollection=e.rolesCollection,this.productsCollection=e.productCollection,this.functionalitiesCollection=e.functionalitiesCollection;var t=TVD_AM_CONST.roles_properties;for(var n in this.initializeEvents(),t)t[n].isActive="administrator"===n,this.rolesCollection.add(t[n]);this.rolesCollection.findWhere({isActive:!0}).activateRole()},initializeEvents:function(){var e=this;this.rolesCollection.on("activate-role",(function(){var t=e.rolesCollection.getActiveRole(),n=t.getProducts(),i=t.getFunctionalities();Object.values(n).forEach((function(e){e.activeRole=t.getTag()})),e.productsCollection.reset(Object.values(n)),Object.values(i).forEach((function(e){e.activeRole=t.getTag()})),e.functionalitiesCollection.reset(Object.values(i)),e.updateRoleInfo(t)})),this.productsCollection.on("change-capability",(function(t){var i=n(t,2),o=i[0],a=i[1];e.rolesCollection.getActiveRole().changeProductCapability(o,a)})),this.functionalitiesCollection.on("change-functionality",(function(t){var i=n(t,2),o=i[0],a=i[1];e.rolesCollection.getActiveRole().changeFunctionalityValue(o,a)}))},render:function(){var e=this;return this.$el.empty(),this.rolesCollection.each((function(t){new a({model:t}).render().appendTo(e.$el)})),this.$el},updateRoleInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rolesCollection.getActiveRole();o(".tvd-am-view-users").attr("href",e.getUrl()),o(".tvd-am-container-role").text(e.getName())}})},55:function(e,t,n){var i,o,a,r;i=jQuery,o=n(56),a=n(57),r=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-default-confirmation"),events:{"click .reset-button.tvd-modal-submit":function(){this.resetDefaults(),this.close()}},initialize:function(e){this.rolesCollection=e.rolesCollection},afterRender:function(){this.$el.addClass("tvd-modal-am-reset"),i(".role-name").text(this.rolesCollection.getActiveRole().getName())},resetDefaults:function(){var e=this,t=this.rolesCollection.getActiveRole(),n=t.getTag();TVE_Dash.showLoader(!0),i.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.reset_capabilities_to_default,role:n},type:"post",dataType:"json"}).done((function(n){if(n.success){var i=n.updated_products,o=n.updated_functionalities;for(var a in i)t.changeProductCapability(a,i[a]);for(var r in o)t.changeFunctionalityValue(r,o[r]);e.rolesCollection.trigger("activate-role"),TVE_Dash.success(n.message,4e3,null,"top")}else TVE_Dash.err(n.message,4e3,null,"top")})).always((function(){TVE_Dash.hideLoader()}))}}),e.exports=Backbone.View.extend({template:TVE_Dash.tpl("views/container"),el:".tvd-am-container",events:{"click .tvd-am-reset-defaults":function(){TVE_Dash.modal(r,{rolesCollection:this.rolesCollection})}},initialize:function(e){this.productsCollection=e.productCollection,this.functionalitiesCollection=e.functionalitiesCollection,this.rolesCollection=e.rolesCollection},render:function(){this.$el.html(this.template());var e=new o({productsCollection:this.productsCollection}),t=new a({functionalitiesCollection:this.functionalitiesCollection});return e.render(),t.render(),this.$el}})},56:function(e,t){var n,i;n=jQuery,i=Backbone.View.extend({template:TVE_Dash.tpl("views/product"),events:{"click .tvd-am-product-cap":function(){this.model.isEditable()&&this.changeCapability()}},initialize:function(){var e=this;this.model.on("change:can_use",(function(){e.render()}))},render:function(){return this.$el.html(this.template({model:this.model,canUse:this.model.canUse()?"cap":"no-cap",isEditable:this.model.isEditable()?"-editable":"-non-editable"})),this.$el},changeCapability:function(){var e=this,t=this.model.canUse()?"remove":"add",i=this.model.getActiveRole(),o=this.model.getProductCapability();TVE_Dash.showLoader(),n.ajax({url:ajaxurl,data:{_wpnonce:TVE_Dash_Const.nonce,action:TVE_Dash_Const.actions.backend_ajax,route:TVE_Dash_Const.routes.change_capability,role:i,capability:o,capability_action:t},type:"post",dataType:"json"}).done((function(n){if(n.success){var i="add"===t;e.model.set({can_use:i}),e.model.collection.trigger("change-capability",[e.model.getTag(),i]),TVE_Dash.success(n.message,4e3,null,"top")}else TVE_Dash.err(n.message,4e3,null,"top")})).always((function(){TVE_Dash.hideLoader()}))}}),e.exports=Backbone.View.extend({el:".tvd-am-products-cap-content",initialize:function(e){var t=this;this.productsCollection=e.productsCollection,this.productsCollection.on("reset",(function(){t.render()}))},render:function(){var e=this;return this.$el.empty(),this.productsCollection.each((function(t){new i({model:t}).render().appendTo(e.$el)})),this.$el}})},57:function(e,t,n){var i,o;jQuery,i=n(58),o=n(16),e.exports=Backbone.View.extend({el:".tvd-am-functionality-content",initialize:function(e){var t=this;this.functionalitiesCollection=e.functionalitiesCollection,this.functionalitiesCollection.on("reset",(function(){t.render()}))},render:function(){var e=this;return this.$el.empty(),this.functionalitiesCollection.each((function(t){var n,a=t.getOptionsType();if(a){switch(a){case"dropdown":n="login_redirect"===t.getTag()?new i({model:t}):new o({model:t})}n.render().appendTo(e.$el),e.$(".tvd-am-functionality-select").select2()}})),this.$el}})},58:function(e,t,n){var i;jQuery,i=n(16),e.exports=i.extend({events:{"select2:select .tvd-am-functionality-select":"selectOption","click .open-remove-options":function(){this.$(".custom-redirect-select-wrapper ").hide(),this.$(".custom-redirect-remove-page-wrapper ").show()},"click .keep-page":function(){this.$(".custom-redirect-select-wrapper ").show(),this.$(".custom-redirect-remove-page-wrapper ").hide()},"click .remove-page":function(){this.changeFunctionality("inherit",!1),this.$("#tvd-am-custom-redirect").val(null).trigger("change",{shouldNotUpdate:!0}),this.$(".custom-redirect-remove-page-wrapper ").hide(),this.toggleCustomRedirectElements(!0)}},selectOption:function(e){var t=e.params.data.id;this.model.getOptions().map((function(e){return e.tag})).includes(t)&&"custom"!==t?(this.$(".custom-redirect-select-wrapper").hide(),this.changeFunctionality(t)):this.toggleCustomRedirectElements(!0)},initializePageSearch:function(e){var t=this;e.find("#tvd-am-custom-redirect").select2({ajax:{url:TVD_AM_CONST.baseUrl,dataType:"json",delay:250,data:function(e){return{search:e.term,status:"publish",type:"page"}},processResults:function(e){return{results:e}}},placeholder:"Search an existing page",templateResult:function(e){return e.loading?e.text:t.renderPageName(e.title.rendered)},templateSelection:function(e){return e.text||t.renderPageName(e.title.rendered)},language:{inputTooShort:function(){return""}}}).on("select2:select",(function(e){void 0===e.params.shouldNotUpdate&&t.changeFunctionality({pageId:e.params.data.id,pageName:t.renderPageName(e.params.data.title.rendered),pageLink:e.params.data.link}).done((function(){t.toggleCustomRedirectElements(!1)}))}))},afterRender:function(){this.$el.find(".tvd-am-functionality-wrapper").append(TVE_Dash.tpl("views/custom-page-redirect")()),this.initializePageSearch(this.$el);var e=this.model.getValue();e&&!this.model.getOptions().map((function(e){return e.tag})).includes(e)&&this.toggleCustomRedirectElements(!1)},toggleCustomRedirectElements:function(e){this.$(".custom-redirect-select-wrapper").show(),this.$("#custom-page-info").toggle(e),this.$("#tvd-am-custom-redirect").toggle(e),this.$("#tvd-am-custom-redirect").next(".select2-container").toggle(e),this.$(".custom-page-options").toggle(!e),e||(this.$(".custom-page-title").text(this.renderPageName(this.model.getValue().pageName)),this.$(".view-page").attr("href",this.model.getValue().pageLink))},renderPageName:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}})},59:function(e,t,n){e.exports=Backbone.Collection.extend({model:n(60)})},60:function(e,t){e.exports=Backbone.Model.extend({getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getLogo:function(){return this.get("logo")},getProductCapability:function(){return this.get("prod_capability")},canUse:function(){return this.get("can_use")},isEditable:function(){return this.get("is_editable")},getActiveRole:function(){return this.get("activeRole")}})},61:function(e,t,n){e.exports=Backbone.Collection.extend({model:n(62)})},62:function(e,t){e.exports=Backbone.Model.extend({getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getDefaultValue:function(){return this.get("default_value")},getValue:function(){return this.get("value")},getIcon:function(){return this.get("icon")},getOptions:function(){return this.get("functionality_options")},getOptionsType:function(){return this.get("get_options_type")},getActiveRole:function(){return this.get("activeRole")}})},63:function(e,t,n){e.exports=Backbone.Collection.extend({model:n(64),getActiveRole:function(){return this.findWhere({isActive:!0})}})},64:function(e,t){e.exports=Backbone.Model.extend({canEditPosts:function(){return this.get("can_edit_posts")},getName:function(){return this.get("name")},getTag:function(){return this.get("tag")},getUrl:function(){return this.get("url")},getProducts:function(e){var t=this.get("products");return e&&(t=t[e]),t},getFunctionalities:function(e){var t=this.get("functionalities");return e&&(t=t[e]),t},isActive:function(){return this.get("isActive")},activateRole:function(){this.collection.findWhere({isActive:!0}).set({isActive:!1}),this.collection.findWhere({tag:this.getTag()}).set({isActive:!0}),this.collection.trigger("activate-role")},changeProductCapability:function(e,t){this.getProducts(e).can_use=t},changeFunctionalityValue:function(e,t){this.getFunctionalities(e).value=t}})}});